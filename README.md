# Гоzон - Микросервисная система

Система представляет собой интернет-магазин с асинхронным взаимодействием микросервисов, гарантирующим надежность финансовых транзакций.

## Описание архитектуры

Решение построено на базе **Microservices Architecture**.
Взаимодействие между сервисами реализовано асинхронно через брокер сообщений **RabbitMQ** с применением библиотеки **MassTransit**.

### Ключевые паттерны и гарантии:
* **API Gateway (YARP):** Единая точка входа для всех запросов.
* **Transactional Outbox:** Гарантирует, что событие создания заказа не потеряется, даже если брокер сообщений недоступен (сохраняется в БД в одной транзакции с заказом).
* **Transactional Inbox:** Обеспечивает дедупликацию входящих сообщений (Idempotency), что позволяет достичь семантики **effectively exactly-once**.
* **Optimistic Concurrency Control:** Защита баланса пользователя от гонки данных (Race Conditions) при параллельных запросах.
* **Asynchronous Communication:** Сервис заказов не ждет немедленного ответа от сервиса оплат, что повышает устойчивость системы.

---


## Инструкция по запуску

### Предварительные требования
* Установленный **Docker Desktop**.

### Запуск
1.  Откройте терминал в корневой папке проекта.
2.  Выполните команду сборки и запуска:
    ```bash
    docker compose up --build
    ```
3.  Дождитесь запуска всех контейнеров (около 15-30 секунд).

### Доступ к сервисам
| Сервис | Адрес | Описание |
| :--- | :--- | :--- |
| **Frontend (Web UI)** | `http://localhost:5003` | Веб-интерфейс магазина |
| **API Gateway** | `http://localhost:8080` | Точка входа для API запросов |
| **Swagger (Orders)** | `http://localhost:5001/swagger` | Документация сервиса заказов |
| **Swagger (Payments)** | `http://localhost:5002/swagger` | Документация сервиса оплат |

---

## Примеры API запросов (CURL)

Если вы не хотите использовать UI, можно тестировать через терминал:

**1. Создание счета:**
```bash
curl -X POST http://localhost:8080/api/payments/account \
   -H "Content-Type: application/json" \
   -d '{"userId": "11111111-1111-1111-1111-111111111111"}'
```
**2. Пополнение баланса:**
```bash
curl -X POST http://localhost:8080/api/payments/topup \
   -H "Content-Type: application/json" \
   -d '{"userId": "11111111-1111-1111-1111-111111111111", "amount": 1000}'
```
**3. Создание заказа:**
```bash
curl -X POST http://localhost:8080/api/orders \
   -H "Content-Type: application/json" \
   -d '{"userId": "11111111-1111-1111-1111-111111111111", "amount": 100, "description": "Test Order"}'
```
**4. Проверка статуса:**
```bash
curl http://localhost:8080/api/orders/{ORDER_ID}
```
